<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>魔仙堡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="温故而知新"/>
<meta name="keywords" content="温故而知新"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://2523615279.github.io//favicon.ico">

<link rel="stylesheet" href="https://2523615279.github.io//styles/main.css">

<!-- Modernizr JS -->
<script src="https://2523615279.github.io//media/scripts/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://2523615279.github.io//media/scripts/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->



<!-- katex -->
<!--<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet">-->

<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">



</head>
<body>
    <div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://2523615279.github.io//images/avatar.png" alt="魔仙堡"
                 class="img-responsive">
        </figure>
        <a href="https://2523615279.github.io//post/about/"><h3 class="heading">ABOUT ME</h3></a>
        <h2>魔仙堡</h2>
        <p>温故而知新</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">

        <!-- 标签 -->
        <div class="fh5co-box">
            <a href="https://2523615279.github.io//tags/"><h3 class="heading">👉标签</h3></a>
            <ul>
                
                    <li><a href="https://2523615279.github.io/tag/4pHBltHIg/">技术</a></li>
                
                    <li><a href="https://2523615279.github.io/tag/_kUh3_weP/">薅羊毛</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                        
                        >
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                        
                        >
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                        
                        >
                            标签
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                        
                        >
                            关于
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://2523615279.github.io/">魔仙堡 </a>
                </h1>
            </div>
        </div>
    </div>
</header>


    <!--  <a href="#" class="fh5co-post-prev"><span>👈 Prev</span></a>-->
    <!--  <a href="#" class="fh5co-post-next"><span>Next 👉</span></a>-->

    <!-- 等gridea出自定义页面功能再优化一下 -->
    
        <div class="container-fluid">
    <div class="row fh5co-post-entry single-entry">
        <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <figure class="animate-box">
                
                    <img src="https://pic.rmb.bdstatic.com/bjh/4c7e78765c68d872e85a38df87687e57.png" alt="CloudFlare Worker 反代TGbot" class="img-responsive">
                
            </figure>
            <span class="fh5co-meta animate-box">
                
                    <div class="tag-container">
                        
                            <a href="https://2523615279.github.io/tag/4pHBltHIg/" class="tag">技术, </a>
                        
                    </div>
                
            </span>
            <h2 class="fh5co-article-title animate-box">CloudFlare Worker 反代TGbot</h2>
            <ol class="breadcrumb fh5co-meta fh5co-date animate-box" style="margin-bottom:0; background-color:#f8f9fa">
                <li>2021-11-25</li>
                <li>489字</li>
                <li>3 min read</li>
            </ol>

            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                <div class="row">
                    <div class="col-md-12 animate-box post-content">
                        <p> <h2 id="开始前的准备">开始前的准备</h2>
<blockquote>
<h3 id="一-注册一个tg机器人">一、注册一个TG机器人</h3>
<blockquote>
<p>1、在TG搜索@BotFather</p>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/940d2b7755daa351678dd00eccb6324c.png" alt="image.png" title="image.png" />
</blockquote>
<p>2、点击进去，点击开始</p>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/733d06b91d7de266c57bb2d2d4d4ef41.png" alt="image.png" title="image.png" />
</blockquote>
<p>3、点击右下角的斜杠，点击newbot</p>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/dcbccf03269709f34a9e52f5e140617f.png" alt="image.png" title="image.png" />
<img src="https://pic.rmb.bdstatic.com/bjh/9f85587f2343320b38191065562eef51.png" alt="image.png" title="image.png" />
</blockquote>
<p>4、点击过后就会让你输入机器人的名字和用来查找机器人的id（后面那个只能输入英文)</p>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/ec11f3be41d2bc5e58164ded1157bf2c.png" alt="image.png" title="image.png" />
<img src="https://pic.rmb.bdstatic.com/bjh/a1950c95fdc5f2ec626880224e124ba9.png" alt="image.png" title="image.png" />
这个bot token复制好，后面要用到
</blockquote>
</blockquote>
</blockquote>
<h2 id="一-注册cloudflare">一、注册CloudFlare</h2>
<blockquote>
<p>cloudflare官网:<a href="https://www.cloudflare.com/zh-cn/">https://www.cloudflare.com/zh-cn/</a><br>
如果不能打开官网的话，请打开vpn然后打开官网。</p>
</blockquote>
<h2 id="二-登录启用cloudflare-worker">二、登录启用CloudFlare Worker</h2>
<blockquote>
<h3 id="1-登录cloudflare后在左上角下拉菜单中找到-workers">1、登录cloudflare后，在左上角下拉菜单中找到 workers。</h3>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/7eeb721360b30fe78a7f05e18d6c6076.png" alt="image.png" title="image.png" />
</blockquote>
</blockquote>
<blockquote>
<h3 id="2-设置一个自定义的子域">2、设置一个自定义的子域</h3>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/48ec9eb745a6fd3fa31d6469ea92b369.png" alt="image.png" title="image.png" />
</blockquote>
</blockquote>
<blockquote>
<h3 id="3-根据自身情况选择合适的计划我这边免费的就够用了">3、根据自身情况选择合适的计划，我这边免费的就够用了。</h3>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/d85d72e2fa0aa7d9f26cf012f4e718da.png" alt="image.png" title="image.png" />
</blockquote>
</blockquote>
<h2 id="三-配置worker">三、配置worker</h2>
<blockquote>
<h3 id="1-点击确认计划后即可进入cf的workers后台点击-创建worker-按钮新建一个worker">1、点击确认计划后，即可进入cf的workers后台，点击 创建worker 按钮，新建一个worker。</h3>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/048ba44295646426b3250633ef4f3899.png" alt="image.png" title="image.png" />
</blockquote>
</blockquote>
<blockquote>
<h3 id="2-进入worker编辑界面输入下面代码后点击安装部署">2、进入worker编辑界面，输入下面代码后，点击安装部署。</h3>
<blockquote>
<pre><code class="language-JavaScript">const whitelist = [&quot;/bot1811111111:&quot;];
const tg_host = &quot;api.telegram.org&quot;;
addEventListener('fetch', event =&gt; {
   event.respondWith(handleRequest(event.request))
})
function validate(path) {
   for (var i = 0; i &lt; whitelist.length; i++) {
       if (path.startsWith(whitelist[i]))
           return true;
   }
   return false;
}
async function handleRequest(request) {
   var u = new URL(request.url);
   u.host = tg_host;
   if (!validate(u.pathname))
       return new Response('Unauthorized', {
           status: 403
       });
   var req = new Request(u, {
       method: request.method,
       headers: request.headers,
       body: request.body
   });
   const result = await fetch(req);
   return result;
} 
</code></pre>
<img src="https://pic.rmb.bdstatic.com/bjh/f0918c8c38652580fd750bfbd1052ef9.png" alt="image.png" title="image.png" />
</blockquote>
</blockquote>
<h2 id="四-测试反代成功没">四、测试反代成功没</h2>
<h3 id="1-测试前的准备">1、测试前的准备</h3>
<blockquote>
<h4 id="获取用户id">获取用户id:</h4>
<blockquote>
<p>tg搜索 @userinfobot，关注一个关注量较多头像有问号的即可。<br>
<img src="https://pic.rmb.bdstatic.com/bjh/c6a29dc1490659e4cc3948ac8d8549ea.png" alt="image.png" title="image.png" /></p>
</blockquote>
</blockquote>
<h3 id="开始测试">开始测试</h3>
<blockquote>
<p>设置成功后即可通过 <code>https://xxxxx.xxx.workers.dev</code> 推送特定信息给特定的用户或群组，链接为worker的链接地址<br>
可以通过<code>https://xxxxx.xxx.workers.dev/bot88888:aaaaa/sendMessage?chat_id=7777&amp;text=yyyy</code> 测试，如果配置正常将能收到推送信息。<br>
将代码中的88888:aaaaa改为自己机器人的token，777改为对话用户id，yyyyy改为要发送的文本。<br>
测试成功的图片：</p>
<blockquote>
<blockquote>
<img src="https://pic.rmb.bdstatic.com/bjh/9e7bcfd50447643e5ac99c85d6dc9098.png" alt="image.png" title="image.png" />
<img src="https://pic.rmb.bdstatic.com/bjh/e325ac52178be48abf333b3e2bd3fc33.png" alt="image.png" title="image.png" />
</blockquote>
</blockquote>
</blockquote>
<p>本文参考：https://www.kejiwanjia.com/jiaocheng/server/5221.html#3worker</p>
 </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 animate-box">
                        
                            <div class="next-post">
                                <div class="next">下一篇</div>
                                <a href="https://2523615279.github.io/post/zhong-qing-kan-dian/">
                                    <h3 class="post-title">
                                        中青看点
                                    </h3>
                                </a>
                            </div>
                        
                    </div>
                </div>

                <div class="row">
    <div class="col-md-12 animate-box">
        
    </div>
</div>

            </div>

        </article>
    </div>
</div>

    

    <!-- 返回顶部 -->
    <div class="back-to-top">
    
        <a href="#!" id="tool-toc" class="hidden-xs hidden-sm">
            <i class="fa fa-map"></i>
        </a>
        <br>
    
    <a href="#top" class="hidden-xs hidden-sm"><i class="fa fa-paper-plane"></i></a>
</div>

<div class="post-toc animated fadeInRight hidden-xs hidden-sm" style="display: none;">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%BC%80%E5%A7%8B%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87">开始前的准备</a>
<ul>
<li><a href="#%E4%B8%80-%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%AAtg%E6%9C%BA%E5%99%A8%E4%BA%BA">一、注册一个TG机器人</a></li>
</ul>
</li>
<li><a href="#%E4%B8%80-%E6%B3%A8%E5%86%8Ccloudflare">一、注册CloudFlare</a></li>
<li><a href="#%E4%BA%8C-%E7%99%BB%E5%BD%95%E5%90%AF%E7%94%A8cloudflare-worker">二、登录启用CloudFlare Worker</a>
<ul>
<li><a href="#1-%E7%99%BB%E5%BD%95cloudflare%E5%90%8E%E5%9C%A8%E5%B7%A6%E4%B8%8A%E8%A7%92%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95%E4%B8%AD%E6%89%BE%E5%88%B0-workers">1、登录cloudflare后，在左上角下拉菜单中找到 workers。</a></li>
<li><a href="#2-%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AD%90%E5%9F%9F">2、设置一个自定义的子域</a></li>
<li><a href="#3-%E6%A0%B9%E6%8D%AE%E8%87%AA%E8%BA%AB%E6%83%85%E5%86%B5%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E8%AE%A1%E5%88%92%E6%88%91%E8%BF%99%E8%BE%B9%E5%85%8D%E8%B4%B9%E7%9A%84%E5%B0%B1%E5%A4%9F%E7%94%A8%E4%BA%86">3、根据自身情况选择合适的计划，我这边免费的就够用了。</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E9%85%8D%E7%BD%AEworker">三、配置worker</a>
<ul>
<li><a href="#1-%E7%82%B9%E5%87%BB%E7%A1%AE%E8%AE%A4%E8%AE%A1%E5%88%92%E5%90%8E%E5%8D%B3%E5%8F%AF%E8%BF%9B%E5%85%A5cf%E7%9A%84workers%E5%90%8E%E5%8F%B0%E7%82%B9%E5%87%BB-%E5%88%9B%E5%BB%BAworker-%E6%8C%89%E9%92%AE%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAworker">1、点击确认计划后，即可进入cf的workers后台，点击 创建worker 按钮，新建一个worker。</a></li>
<li><a href="#2-%E8%BF%9B%E5%85%A5worker%E7%BC%96%E8%BE%91%E7%95%8C%E9%9D%A2%E8%BE%93%E5%85%A5%E4%B8%8B%E9%9D%A2%E4%BB%A3%E7%A0%81%E5%90%8E%E7%82%B9%E5%87%BB%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2">2、进入worker编辑界面，输入下面代码后，点击安装部署。</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%B5%8B%E8%AF%95%E5%8F%8D%E4%BB%A3%E6%88%90%E5%8A%9F%E6%B2%A1">四、测试反代成功没</a>
<ul>
<li><a href="#1-%E6%B5%8B%E8%AF%95%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87">1、测试前的准备</a>
<ul>
<li><a href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7id">获取用户id:</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E5%A7%8B%E6%B5%8B%E8%AF%95">开始测试</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://moxianbaobbs.top/" target="_blank">魔仙堡</a></p>
</footer>


    <!-- jQuery -->
<script src="https://2523615279.github.io//media/scripts/jquery.min.js"></script>
<!-- img lazy load -->
<script src="https://2523615279.github.io//media/scripts/jquery.lazyload.min.js"></script>
<!-- jQuery Easing -->
<script src="https://2523615279.github.io//media/scripts/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://2523615279.github.io//media/scripts/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://2523615279.github.io//media/scripts/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://2523615279.github.io//media/scripts/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://2523615279.github.io//media/scripts/md5.min.js"></script>
<!-- katex -->
<!--<script src="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js"></script>-->
<!-- highlight -->
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>


<script type="application/javascript">
    // 代码高亮
    hljs.initHighlightingOnLoad();

    // img 懒加载
    $(function () {
        $("img.lazy").lazyload({
            effect: "fadeIn",  // 懒加载动画
            threshold: 180  // 在图片距离屏幕180px时提前载入
        });
        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // 目录
        $('#tool-toc').click(function () {
            $('.post-toc').toggle();
        });
    });

    
</script>




</body>
</html>
